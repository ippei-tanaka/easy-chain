(function(){function t(t,e,n){this.type=t,this.target=e;for(var s in n)n.hasOwnProperty(s)&&(this[s]=n[s])}function e(t,e){this.callback=t,this.context=e}function n(t){this._deferred=t}function s(){this._doneCallbacks=[],this._failCallbacks=[],this._status=null,this._arguments=null}function i(t){this._command=t,this._deferred=new s,this._output=void 0,this._deferred.done(p(function(t){this._output=t},this))}function r(t,e,n){this._initialize(t,e,n)}function o(){this._tasks=[],this._eventListeners={},this._eventListeners[o.Events.COMPLETE]=[],this._eventListeners[o.Events.TIMEOUT]=[],this._eventListeners[o.Events.PROGRESS]=[]}var u=function(t){return"function"==typeof t},h=function(t){return"[object Array]"===Object.prototype.toString.call(t)},c=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},a=function(t){return t.length>0?Array.prototype.slice.call(t):[]},p=function(t,e){return function(){return t.apply(e,arguments)}},f=function(t,e){for(var n=0;n<t.length;n++)e(t[n],n)},_=function(t,e){for(var n,s=[],i=0;i<t.length;i++)n=t[i],e(n,i)&&s.push(n);return s},l=function(t,e){return _(t,function(t,n){return!e(t,n)})},y=function(t,e){for(var n,s=[],i=0;i<t.length;i++)n=t[i],s.push(e(n,i));return s},d=jQuery?function(t){var e=String(jQuery.Deferred().then).substring(10,20);return c(t)&&u(t.then)?e===String(t.then).substring(10,20):!1}:function(){return!1};n.prototype.done=function(t){return this._deferred.done(t),this},n.prototype.fail=function(t){return this._deferred.fail(t),this},s.prototype.resolve=function(){return this._status||(this._status="resolved",this._arguments=a(arguments),f(this._doneCallbacks,p(function(t){t.apply(null,this._arguments)},this))),this},s.prototype.reject=function(){return this._status||(this._status="rejected",this._arguments=a(arguments),f(this._failCallbacks,p(function(t){t.apply(null,this._arguments)},this))),this},s.prototype.done=function(t){return this._doneCallbacks.push(t),"resolved"===this._status&&t.apply(null,this._arguments),this},s.prototype.fail=function(t){return this._failCallbacks.push(t),"rejected"===this._status&&t.apply(null,this._arguments),this},s.prototype.promise=function(){return new n(this)},s.prototype.getStatus=function(){return this._status},s.whenAllDone=function(t){var e=new s,n=0,i=t.length;return f(t,function(t){t.done(function(){n++,n===i&&e.resolve()})}),e.promise()},s.whenAnyDone=function(t){var e=new s;return f(t,function(t){t.done(function(){e.resolve()})}),e.promise()},i.prototype.execute=function(t){var e;t=t||{},u(this._command)?(e=this._command(p(function(){this._deferred.resolve(a(arguments))},this),t.prevTask),d(e)&&e.done(p(function(){this._deferred.resolve(a(arguments))},this))):d(this._command)?this._command.done(p(function(){this._deferred.resolve(a(arguments))},this)):this._command instanceof o&&this._command._runTasksFrom(0).done(p(function(t){this._deferred.resolve(t.length<2?t[0]:t)},this))},i.prototype.getOutput=function(){return this._output},i.prototype.getDeferred=function(){return this._deferred},r.prototype._initialize=function(t,e,n){this._type=t,this._deferred=new s,this._timeout=n,this._timeoutId=null,this._commands=null,this._waitTime=null,this._type===r.Types.SINGLE||this._type===r.Types.ALL?(this._commands=y(e,function(t){return new i(t)}),s.whenAllDone(y(this._commands,function(t){return t.getDeferred().promise()})).done(p(function(){this._clearTimeout(),this._deferred.resolve()},this))):this._type===r.Types.ANY?(this._commands=y(e,function(t){return new i(t)}),s.whenAnyDone(y(this._commands,function(t){return t.getDeferred().promise()})).done(p(function(){this._clearTimeout(),this._deferred.resolve()},this))):this._type===r.Types.WAIT&&(this._waitTime=e,this._commands=[new i(p(function(){setTimeout(p(function(){this._deferred.resolve()},this),this._waitTime)},this))])},r.prototype._runJobs=function(t){f(this._commands,p(function(e){e.execute(t)},this))},r.prototype._setTimeout=function(){this._timeoutId=setTimeout(p(function(){this._deferred.reject()},this),this._timeout||r.TIMEOUT)},r.prototype._clearTimeout=function(){clearTimeout(this._timeoutId)},r.prototype.run=function(t){return this._runJobs(t),this._setTimeout(),this._deferred.promise()},r.prototype.getType=function(){return this._type},r.prototype.getValues=function(){return this._type===r.Types.ALL||this._type===r.Types.ANY?y(this._commands,function(t){return t.getOutput()}):this._type===r.Types.SINGLE?this._commands[0].getOutput():this._type===r.Types.WAIT?this._waitTime:void 0},r.prototype.getStatus=function(){return this._deferred.getStatus()},r.createSingleType=function(t,e){return t=h(t)?t:[t],new r(r.Types.SINGLE,t,e)},r.createAllType=function(t,e){return t=h(t)?t:[t],new r(r.Types.ALL,t,e)},r.createAnyType=function(t,e){return t=h(t)?t:[t],new r(r.Types.ANY,t,e)},r.createWaitType=function(t){return new r(r.Types.WAIT,t)},r.TIMEOUT=5e3,r.Types={SINGLE:"single",ALL:"all",ANY:"any",WAIT:"wait"},r.Events={TIMEOUT:"timeout"},o.prototype._fireEvent=function(t){var e=arguments.length>0?Array.prototype.slice.call(arguments,1):[];return f(this._eventListeners[t],function(t){t.callback.apply(t.context||{},e)}),this},o.prototype._runTasksFrom=function(e){var n=this._tasks[e],i=this._tasks[e-1],r=i?{prevTask:i}:{},u=new s;return n?n.run(r).done(p(function(){this._fireEvent(o.Events.PROGRESS,new t(o.Events.PROGRESS,this,{task:n,index:e})),this._runTasksFrom(e+1).done(p(function(t){t.unshift(n),u.resolve(t)},this))},this)).fail(p(function(){this._fireEvent(o.Events.TIMEOUT,new t(o.Events.TIMEOUT,this,{task:n,index:e}))},this)):u.resolve([]),u.promise()},o.prototype._on=function(t,n,s){return this._eventListeners[t]&&this._eventListeners[t].push(new e(n,s)),this},o.prototype._off=function(t,e,n){return this._eventListeners[t]&&(e&&(this._eventListeners[t]=l(this._eventListeners[t],function(t){return t.callback===e})),n&&(this._eventListeners[t]=l(this._eventListeners[t],function(t){return t.context===n})),e||n||(this._eventListeners[t]=[])),this},o.prototype.do=function(t,e){return this._tasks.push(r.createSingleType(t,e)),this},o.prototype.doAll=function(t,e){return this._tasks.push(r.createAllType(t,e)),this},o.prototype.doAny=function(t,e){return this._tasks.push(r.createAnyType(t,e)),this},o.prototype.wait=function(t){return this._tasks.push(r.createWaitType(t)),this},o.prototype.run=function(){return this._runTasksFrom(0).done(p(function(){this._fireEvent(o.Events.COMPLETE,new t(o.Events.COMPLETE,this,{type:o.Events.COMPLETE,length:this._tasks.length}))},this))},o.prototype.empty=function(){return this._tasks=[],this},o.prototype.on=function(t,e,n){return this._on(t,e,n)},o.prototype.off=function(t,e,n){return this._off(t,e,n)},o.do=function(t,e){var n=new o;return n.do(t,e)},o.doAll=function(t,e){var n=new o;return n.doAll(t,e)},o.doAny=function(t,e){var n=new o;return n.doAny(t,e)},o.wait=function(t){var e=new o;return e.wait(t)},o.Events={COMPLETE:"complete",PROGRESS:"progress",TIMEOUT:"timeout"},this.EasyChain=o,this.EasyChain.Deferred=s,this.EasyChain.Task=r}).call(this);