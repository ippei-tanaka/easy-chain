!function(t){function e(t,e,n){this.type=t,this.target=e;for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i])}function n(t,e){this.callback=t,this.context=e}function i(t){this._deferred=t}function s(){this._doneCallbacks=[],this._failCallbacks=[],this._status=null,this._arguments=null}function r(t){this.callback=t,this.deferred=new s,this.value=void 0,this.deferred.done(p(function(t){this.value=t},this))}function u(t,e,n){this._initialize(t,e,n)}function o(){this._queues=[],this._eventListeners={},this._eventListeners[o.Events.COMPLETE]=[],this._eventListeners[o.Events.TIMEOUT]=[],this._eventListeners[o.Events.PROGRESS]=[]}var h=function(t){return"function"==typeof t},c=function(t){return"[object Array]"===Object.prototype.toString.call(t)},a=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},f=function(t){return t.length>0?Array.prototype.slice.call(t):[]},p=function(t,e){return function(){return t.apply(e,arguments)}},l=function(t,e){for(var n=0;n<t.length;n++)e(t[n],n)},y=function(t,e){for(var n,i=[],s=0;s<t.length;s++)n=t[s],e(n,s)&&i.push(n);return i},d=function(t,e){return y(t,function(t,n){return!e(t,n)})},v=function(t,e){for(var n,i=[],s=0;s<t.length;s++)n=t[s],i.push(e(n,s));return i},_=jQuery?function(t){var e=String(jQuery.Deferred().then).substring(10,20);return a(t)&&h(t.then)?e===String(t.then).substring(10,20):!1}:function(){return!1};i.prototype.done=function(t){return this._deferred.done(t),this},i.prototype.fail=function(t){return this._deferred.fail(t),this},s.prototype.resolve=function(){return this._status||(this._status="resolved",this._arguments=f(arguments),l(this._doneCallbacks,p(function(t){t.apply(null,this._arguments)},this))),this},s.prototype.reject=function(){return this._status||(this._status="rejected",this._arguments=f(arguments),l(this._failCallbacks,p(function(t){t.apply(null,this._arguments)},this))),this},s.prototype.done=function(t){return this._doneCallbacks.push(t),"resolved"===this._status&&t.apply(null,this._arguments),this},s.prototype.fail=function(t){return this._failCallbacks.push(t),"rejected"===this._status&&t.apply(null,this._arguments),this},s.prototype.promise=function(){return new i(this)},s.whenAllDone=function(t){var e=new s,n=0,i=t.length;return l(t,function(t){t.done(function(){n++,n===i&&e.resolve()})}),e.promise()},s.whenAnyDone=function(t){var e=new s;return l(t,function(t){t.done(function(){e.resolve()})}),e.promise()},u.prototype._initialize=function(t,e,n){this.type=t,this.deferred=new s,this.timeout=n,this.timeoutId=null,this.queueItems=null,this.waitTime=null,this.type===u.Types.SINGLE||this.type===u.Types.ALL?(this.queueItems=v(e,function(t){return new r(t)}),s.whenAllDone(v(this.queueItems,function(t){return t.deferred.promise()})).done(p(function(){this._clearTimeout(),this.deferred.resolve()},this))):this.type===u.Types.ANY?(this.queueItems=v(e,function(t){return new r(t)}),s.whenAnyDone(v(this.queueItems,function(t){return t.deferred.promise()})).done(p(function(){this._clearTimeout(),this.deferred.resolve()},this))):this.type===u.Types.WAIT&&(this.waitTime=e,this.queueItems=[new r(p(function(){setTimeout(p(function(){this.deferred.resolve()},this),this.waitTime)},this))])},u.prototype._runQueueItems=function(t){t=t||{},l(this.queueItems,p(function(e){var n;h(e.callback)?(n=e.callback(function(){e.deferred.resolve(f(arguments))},t.prevQueue),_(n)&&n.done(function(){e.deferred.resolve(f(arguments))})):_(e.callback)?e.callback.done(function(){e.deferred.resolve(f(arguments))}):e.callback instanceof o&&e.callback._runQueuesFrom(0).done(function(t){e.deferred.resolve(t.length<2?t[0]:t)})},this))},u.prototype._setTimeout=function(){this.timeoutId=setTimeout(p(function(){this.deferred.reject()},this),this.timeout||u.TIMEOUT)},u.prototype._clearTimeout=function(){clearTimeout(this.timeoutId)},u.prototype.run=function(t){return this._runQueueItems(t),this._setTimeout(),this.deferred.promise()},u.prototype.getType=function(){return this.type},u.prototype.getValues=function(){return this.type===u.Types.ALL||this.type===u.Types.ANY?v(this.queueItems,function(t){return t.value}):this.type===u.Types.SINGLE?this.queueItems[0].value:this.type===u.Types.WAIT?this.waitTime:void 0},u.prototype.getStatus=function(){return this.deferred._status},u.createSingleType=function(t,e){return t=c(t)?t:[t],new u(u.Types.SINGLE,t,e)},u.createAllType=function(t,e){return t=c(t)?t:[t],new u(u.Types.ALL,t,e)},u.createAnyType=function(t,e){return t=c(t)?t:[t],new u(u.Types.ANY,t,e)},u.createWaitType=function(t){return new u(u.Types.WAIT,t)},u.TIMEOUT=5e3,u.Types={SINGLE:"single",ALL:"all",ANY:"any",WAIT:"wait"},u.Events={TIMEOUT:"timeout"},o.prototype._fireEvent=function(t){var e=arguments.length>0?Array.prototype.slice.call(arguments,1):[];return l(this._eventListeners[t],function(t){t.callback.apply(t.context||{},e)}),this},o.prototype._runQueuesFrom=function(t){var n=this._queues[t],i=this._queues[t-1],r=i?{prevQueue:i}:{},u=new s;return n?n.run(r).done(p(function(){this._fireEvent(o.Events.PROGRESS,new e(o.Events.PROGRESS,this,{queue:n,index:t})),this._runQueuesFrom(t+1).done(p(function(t){t.unshift(n),u.resolve(t)},this))},this)).fail(p(function(){this._fireEvent(o.Events.TIMEOUT,new e(o.Events.TIMEOUT,this,{queue:n,index:t}))},this)):u.resolve([]),u.promise()},o.prototype._on=function(t,e,i){return this._eventListeners[t]&&this._eventListeners[t].push(new n(e,i)),this},o.prototype._off=function(t,e,n){return this._eventListeners[t]&&(e&&(this._eventListeners[t]=d(this._eventListeners[t],function(t){return t.callback===e})),n&&(this._eventListeners[t]=d(this._eventListeners[t],function(t){return t.context===n})),e||n||(this._eventListeners[t]=[])),this},o.prototype.do=function(t,e){return this._queues.push(u.createSingleType(t,e)),this},o.prototype.doAll=function(t,e){return this._queues.push(u.createAllType(t,e)),this},o.prototype.doAny=function(t,e){return this._queues.push(u.createAnyType(t,e)),this},o.prototype.wait=function(t){return this._queues.push(u.createWaitType(t)),this},o.prototype.run=function(){return this._runQueuesFrom(0).done(p(function(){this._fireEvent(o.Events.COMPLETE,new e(o.Events.COMPLETE,this,{type:o.Events.COMPLETE,length:this._queues.length}))},this))},o.prototype.empty=function(){return this._queues=[],this},o.prototype.on=function(t,e,n){return this._on(t,e,n)},o.prototype.off=function(t,e,n){return this._off(t,e,n)},o.wait=function(t){var e=new o;return e.wait(t)},o.do=function(t){var e=new o;return e.do(t)},o.doAll=function(){var t=new o;return t.doAll.apply(t,arguments)},o.doAny=function(){var t=new o;return t.doAny.apply(t,arguments)},o.Events={COMPLETE:"complete",PROGRESS:"progress",TIMEOUT:"timeout"},t.EasyChain=o,t.EasyChain.Deferred=s,t.EasyChain.Queue=u}(this);