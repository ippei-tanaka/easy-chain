!function(t){function e(t,e,n){this.type=t,this.target=e;for(var s in n)n.hasOwnProperty(s)&&(this[s]=n[s])}function n(t,e){this.callback=t,this.context=e}function s(t,e){this.type=t,this.callbacks=e,this.nextHasBeenCalled=!1,this.eventValues=e?new Array(e.length):[],this.onComplete=null}function i(){this._queues=[],this._eventListeners={},this._eventListeners[i.COMPLETE]=[],this._eventListeners[i.TIMEOUT_ERROR]=[],this._eventListeners[i.PROGRESS]=[],this._timeout=null}var r=function(t){return"function"==typeof t},u=function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=function(t){return"number"==typeof t},a=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},h=function(t,e){return function(){return t.apply(e,arguments)}},p=function(t,e){for(var n=0;n<t.length;n++)e(t[n],n)},l=function(t,e){for(var n,s=[],i=0;i<t.length;i++)n=t[i],e(n,i)&&s.push(n);return s},c=function(t,e){return l(t,function(t,n){return!e(t,n)})},f=function(t){var e=0;return p(t,function(t){t&&e++}),e},y=jQuery?function(t){var e=String(jQuery.Deferred().then).substring(10,20);return a(t)&&r(t.then)?e===String(t.then).substring(10,20):!1}:function(){return!1};s.prototype._attemptToGoToNext=function(t){return h(function(){this.type===s.WAIT?this.eventValues=arguments[0]:this.type===s.SINGLE?this.eventValues=Array.prototype.slice.call(arguments):this.eventValues[t]=Array.prototype.slice.call(arguments),this.nextHasBeenCalled||this.type!==s.SINGLE&&this.type!==s.WAIT&&this.type!==s.FIRST&&(this.type!==s.ALL||f(this.eventValues)!==this.callbacks.length)||(this.nextHasBeenCalled=!0,this.onComplete())},this)},s.prototype.run=function(t){this.onComplete=t.onComplete,p(this.callbacks,h(function(e,n){var s;r(e)?(s=e(this._attemptToGoToNext(n),t.prevEventValues),y(s)&&s.done(this._attemptToGoToNext(n),t.prevEventValues)):y(e)?e.done(this._attemptToGoToNext(n),t.prevEventValues):e instanceof i&&e._runQueues(0,{onComplete:this._attemptToGoToNext(n)})},this))},s.ALL="all",s.FIRST="first",s.SINGLE="single",s.WAIT="wait",i.prototype._fireEvent=function(t){var e=arguments.length>0?Array.prototype.slice.call(arguments,1):[];return p(this._eventListeners[t],function(t){t.callback.apply(t.context||{},e)}),this},i.prototype._runQueues=function(t,n){var s,u=this._queues[t],o=this._queues[t-1];u?(s=setTimeout(h(function(){this._fireEvent(i.TIMEOUT_ERROR,new e(i.TIMEOUT_ERROR,this,{values:u.eventValues,queueType:u.type,index:t}))},this),this._timeout||i.TIMEOUT_MSEC),u.run({onComplete:h(function(){clearTimeout(s),this._fireEvent(i.PROGRESS,new e(i.PROGRESS,this,{values:u.eventValues,queueType:u.type,index:t})),this._runQueues(t+1,n)},this),prevEventValues:o?o.eventValues:void 0})):r(n.onComplete)&&n.onComplete()},i.prototype.single=function(t){if(!r(t))throw new TypeError("single() takes only function.");return this._queues.push(new s(s.SINGLE,[t])),this},i.prototype.all=function(){var t=u(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return this._queues.push(new s(s.ALL,t)),this},i.prototype.first=function(){var t=u(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return this._queues.push(new s(s.FIRST,t)),this},i.prototype.wait=function(t){if(!o(t))throw new TypeError("wait() takes only number.");return this._queues.push(new s(s.WAIT,[function(e){setTimeout(function(){e(t)},t)}])),this},i.prototype.run=function(){return this._runQueues(0,{onComplete:h(function(){this._fireEvent(i.COMPLETE,new e(i.COMPLETE,this,{type:i.COMPLETE,length:this._queues.length}))},this)}),this},i.prototype.empty=function(){return this._queues=[],this},i.prototype.on=function(t,e,s){return this._eventListeners[t]&&this._eventListeners[t].push(new n(e,s)),this},i.prototype.off=function(t,e,n){return this._eventListeners[t]&&(e&&(this._eventListeners[t]=c(this._eventListeners[t],function(t){return t.callback===e})),n&&(this._eventListeners[t]=c(this._eventListeners[t],function(t){return t.context===n})),e||n||(this._eventListeners[t]=[])),this},i.prototype.setTimeout=function(t){return this._timeout=t,this},i.wait=function(t){var e=new i;return e.wait(t)},i.single=function(t){var e=new i;return e.single(t)},i.all=function(){var t=new i;return t.all.apply(t,arguments)},i.first=function(){var t=new i;return t.first.apply(t,arguments)},i.TIMEOUT_MSEC=5e3,i.COMPLETE="complete",i.PROGRESS="progress",i.TIMEOUT_ERROR="timeout-error",t.EasyChain=i}(this);