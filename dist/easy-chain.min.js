!function(t){function e(t,e,n){this.type=t,this.target=e;for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i])}function n(t,e){this.callback=t,this.context=e}function i(t,e){this.type=t,this.callbacks=e,this.nextHasBeenCalled=!1,this.eventValues=e?new Array(e.length):[],this.onComplete=null}function r(t){t=t||{},this._queues=[],this._eventListeners={},this._eventListeners[r.COMPLETE]=[],this._eventListeners[r.TIMEOUT_ERROR]=[],this._eventListeners[r.PROGRESS]=[],this._timeout=t.timeout}var s=function(t){return"function"==typeof t},u=function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=function(t){return"number"==typeof t},a=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},h=function(t,e){return function(){return t.apply(e,arguments)}},c=function(t,e){for(var n=0;n<t.length;n++)e(t[n],n)},p=function(t,e){for(var n,i=[],r=0;r<t.length;r++)n=t[r],e(n,r)&&i.push(n);return i},l=function(t,e){return p(t,function(t,n){return!e(t,n)})},f=function(t){var e=0;return c(t,function(t){t&&e++}),e},y=jQuery?function(t){var e=String(jQuery.Deferred().then).substring(10,20);return a(t)&&s(t.then)?e===String(t.then).substring(10,20):!1}:function(){return!1};i.prototype._attemptToGoToNext=function(t){return h(function(){this.type===i.WAIT?this.eventValues=arguments[0]:this.type===i.SINGLE?this.eventValues=Array.prototype.slice.call(arguments):this.eventValues[t]=Array.prototype.slice.call(arguments),this.nextHasBeenCalled||this.type!==i.SINGLE&&this.type!==i.WAIT&&this.type!==i.FIRST&&(this.type!==i.ALL||f(this.eventValues)!==this.callbacks.length)||(this.nextHasBeenCalled=!0,this.onComplete())},this)},i.prototype.run=function(t){this.onComplete=t,c(this.callbacks,h(function(t,e){var n;s(t)?(n=t(this._attemptToGoToNext(e)),y(n)&&n.done(this._attemptToGoToNext(e))):t instanceof r&&t._runQueues(0,this._attemptToGoToNext(e))},this))},i.ALL="all",i.FIRST="first",i.SINGLE="single",i.WAIT="wait",r.prototype._fireEvent=function(t){var e=arguments.length>0?Array.prototype.slice.call(arguments,1):[];return c(this._eventListeners[t],function(t){t.callback.apply(t.context||{},e)}),this},r.prototype._runQueues=function(t,n){var i,s=this._queues[t];s?(i=setTimeout(h(function(){this._fireEvent(r.TIMEOUT_ERROR,new e(r.TIMEOUT_ERROR,this,{values:s.eventValues,queueType:s.type,index:t}))},this),this._timeout||r.TIMEOUT_MSEC),s.run(h(function(){clearTimeout(i),this._fireEvent(r.PROGRESS,new e(r.PROGRESS,this,{values:s.eventValues,queueType:s.type,index:t})),this._runQueues(t+1,n)},this))):n()},r.prototype.single=function(t){if(!s(t))throw new TypeError("single() takes only function.");return this._queues.push(new i(i.SINGLE,[t])),this},r.prototype.all=function(){var t=u(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return this._queues.push(new i(i.ALL,t)),this},r.prototype.first=function(){var t=u(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return this._queues.push(new i(i.FIRST,t)),this},r.prototype.wait=function(t){if(!o(t))throw new TypeError("wait() takes only number.");return this._queues.push(new i(i.WAIT,[function(e){setTimeout(function(){e(t)},t)}])),this},r.prototype.run=function(){return this._runQueues(0,h(function(){this._fireEvent(r.COMPLETE,new e(r.COMPLETE,this,{type:r.COMPLETE,length:this._queues.length}))},this)),this},r.prototype.empty=function(){return this._queues=[],this},r.prototype.on=function(t,e,i){return this._eventListeners[t]&&this._eventListeners[t].push(new n(e,i)),this},r.prototype.off=function(t,e,n){return this._eventListeners[t]&&(e&&(this._eventListeners[t]=l(this._eventListeners[t],function(t){return t.callback===e})),n&&(this._eventListeners[t]=l(this._eventListeners[t],function(t){return t.context===n})),e||n||(this._eventListeners[t]=[])),this},r.wait=function(t){var e=new r;return e.wait(t)},r.single=function(t){var e=new r;return e.single(t)},r.all=function(){var t=new r;return t.all.apply(t,arguments)},r.first=function(){var t=new r;return t.first.apply(t,arguments)},r.TIMEOUT_MSEC=5e3,r.COMPLETE="complete",r.PROGRESS="progress",r.TIMEOUT_ERROR="timeout-error",t.EasyChain=r}(this);